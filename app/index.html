<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Programa Calculo</title>
    <link rel="stylesheet" href="index.css">
    <script src="https://www.geogebra.org/apps/deployggb.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/9.4.4/math.min.js"></script>
</head>
<body>
    <div class="container">
        <div id="ggb-element"></div>
        <div class="container-func">
            <h2>Calculadora de Derivadas</h2>
            
            <p>Insira a função polinomial (por exemplo, 2x^2 - 3x + 4):</p>
            
            <div class="input-group">
                <label for="function">f(x) =</label>
                <input id="function" type="text">
                <button onclick="calculate()">Calcular Derivada</button>
            </div>
            
            <p id="output"></p>
        </div>
    </div>
</body>
</html>

<script>
  var params = {"appName": "graphing", "width": 800, "height": 600, "showToolBar": true, "showAlgebraInput": true, "showMenuBar": true };
        var applet = new GGBApplet(params, true);
        window.addEventListener("load", function() {
            applet.inject('ggb-element', 'auto', 'preferHTML5');
        });
        function calculate() {
            var funcao = document.getElementById("function").value; // Pegando a função do input
            funcao = funcao.replace(/\s/g, ''); // Removendo espaços da função
            var termos = funcao.split(/(?=[+-])/); // Separando os termos da função
            var derivada = ''; // Inicializando a derivada

            for (var i = 0; i < termos.length; i++) { // For rodando todos os termos escritos no input
                var term = termos[i]; // Pegando o termo atual

                if (term.includes('x')) { // Verificando se o termo atual possui o X
                    var coeficiente = term.split('x')[0]; // Pegando o coeficiente do termo atual
                    coeficiente = coeficiente === '+' || coeficiente === '' ? 1 : coeficiente === '-' ? -1 : parseFloat(coeficiente); // Trata coeficientes implícitos

                    var expoente = parseFloat(term.split('^')[1] || '1'); // Pegando o expoente do termo atual

                    var novoCoeficiente = coeficiente * expoente; // Calculando o novo coeficiente para derivada
                    var novoExpoente = expoente - 1; // Calculando o novo expoente para derivada

                    var sinal = novoCoeficiente >= 0 ? ' + ' : ''; // Adiciona o sinal de '+' se o coeficiente for positivo, nada se for negativo

                    if (novoExpoente === 1) { // Verificando se o novo expoente é 1 para não exibir o expoente
                        derivada += sinal + novoCoeficiente + 'x '; // Adicionando o novo termo na derivada
                    } else if (novoExpoente !== 0) { // Verificando se o novo expoente é diferente de 0 para exibir o expoente
                        derivada += sinal + novoCoeficiente + 'x^' + novoExpoente + ' '; // Adicionando o novo termo na derivada
                    } else {
                        derivada += sinal + novoCoeficiente + ' '; // Se não tiver expoente exibe apenas o coeficiente
                    }
                }
            }
            document.getElementById("output").innerHTML = 'Resultado:<br>f\'(x) = ' + derivada; // Inserindo o resultado no HTML

    var calcularValorFuncional = confirm("Deseja calcular valor funcional?");
    if (calcularValorFuncional) {
        var ponto_a = parseFloat(prompt("Qual o valor de a?"));
        var scope = { x: ponto_a }; // Define o escopo para a substituição de variáveis

    try {
        var fa = math.evaluate(funcao, scope);
        var fpa = math.evaluate(derivada, scope);
        document.getElementById("output").innerHTML += '<br>f(a) = ' + fa;
        document.getElementById("output").innerHTML += '<br>f\'(a) = ' + fpa;
        document.getElementById("output").innerHTML += '<br>Ponto P(a, f(a)) = (' + ponto_a + ', ' + fa + ')';
    } catch (error) {
        alert("Erro ao calcular a função ou sua derivada: " + error.message);
    }
    }

    var calcularRetaTangente = confirm("Deseja calcular equacao da reta tangente ao gráfico de f no ponto P(a, f(a))?");
    if (calcularRetaTangente) {
        var a = parseFloat(prompt("Qual o valor de a?"));
        var scope = { x: a }; // Define o escopo para a substituição de variáveis

    try {
        var fa = math.evaluate(funcao, scope);
        var fpa = math.evaluate(derivada, scope);
        var retaTangente = 'y = ' + fpa + ' * (x - ' + a + ') + ' + fa;
        document.getElementById("output").innerHTML += '<br>A equação da reta tangente ao gráfico de f no ponto P(' + a + ', ' + fa + ') é ' + retaTangente;
    } catch (error) {
        alert("Erro ao calcular a equação da reta tangente: " + error.message);
    }
    }
}
</script>